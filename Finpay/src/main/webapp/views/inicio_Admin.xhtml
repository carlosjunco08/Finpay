<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./admin_Template.xhtml">

            <ui:define name="content">


                <div class="table-responsive-wrapper"> 
                    <table border="1"  id="t-all" class="jsf-data-table display nowrap" width="100%"  >

                        <thead>
                            <tr><th><h:form>
                                        <h:commandButton value="Crear Usuarios"
                                                         action="#{usuariosController.crearUsuarioPartOne()}"
                                                         styleClass="btn-custom btn-crear">
                                            <f:ajax execute="@form" render="modalForm" onevent="abrirModalUsuario" />
                                        </h:commandButton>
                                    </h:form></th></tr>
                            <tr>
                                <th>Rol</th>
                                <th>Nombre de Usuario</th>
                                <th>Nombres</th>
                                <th>Apellidos</th>
                                <th>Identificacion</th>
                                <th>Email</th>
                                <th>Telefono</th>
                                <th>Direccion</th>
                                <th>Edad</th>
                                <th>Contraseña</th>
                                <th>Pais</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ui:repeat value="#{usuariosController.listarUsuarios()}"  var="user">
                                <tr>
                                    <td>#{user.rolId.nombreRol}</td>
                                    <td>#{user.nombreUsuario}</td>
                                    <td>#{user.nombres}</td>
                                    <td>#{user.apellidos}</td>
                                    <td>#{user.identificacion}</td>
                                    <td>#{user.correo}</td>
                                    <td>#{user.telefono}</td>
                                    <td>#{user.direccion}</td>
                                    <td>#{user.edad}</td>
                                    <td>#{user.contraseña}</td>
                                    <td>#{user.paisId.nombrePais}</td>
                                    <td>#{user.rolId.estadoRolId.estadoRol}</td>
                                    <td>
                                        <h:form>
                                            <h:commandButton value="Editar"
                                                             action="#{usuariosController.editarUserOne(user)}"
                                                             styleClass="btn-custom btn-editar">
                                                <f:ajax execute="@form" render="modalForm" onevent="abrirModalUsuario" />
                                            </h:commandButton>

                                            <h:commandButton value="Eliminar"
                                                             action="#{usuariosController.Eliminar(user)}"
                                                             styleClass="btn-custom btn-eliminar">
                                                <f:ajax execute="@this" render="formUsuarios mensajes" />
                                            </h:commandButton>
                                        </h:form>
                                    </td>
                                </tr>
                            </ui:repeat>
                        </tbody>
                    </table>
                </div>
                <h:form id="modalForm">
                    <div class="modal fade" id="modalUsuario" tabindex="-1" aria-labelledby="modalUsuarioLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl modal-dialog-centered">
                            <div class="modal-content modal-he">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="modalUsuarioLabel">
                                        #{usuariosController.user.identificacion == null ? 'Registrar Usuario' : 'Editar Usuario'}
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                </div>

                                <div class="modal-body">
                                    <div class="container">
                                        <div class="row g-3">

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="nombre_user" value="#{usuariosController.user.nombreUsuario    }" styleClass="form-control" required="true"/>
                                                <label for="nombre_user" class="label-custom">Nombre de Usuario</label>
                                            </div>
                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="nombres" value="#{usuariosController.user.nombres}" styleClass="form-control" required="true"/>
                                                <label for="nombres" class="label-custom">Nombres</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="apellidos" value="#{usuariosController.user.apellidos}" styleClass="form-control" required="true"/>
                                                <label for="apellidos" class="label-custom">Apellidos</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="identificacion" value="#{usuariosController.user.identificacion}" styleClass="form-control" required="true"/>
                                                <label for="identificacion" class="label-custom" >Identificación</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="correo" value="#{usuariosController.user.correo}" styleClass="form-control" required="true"/>
                                                <label for="correo" class="label-custom">Correo</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="telefono" value="#{usuariosController.user.telefono}" styleClass="form-control" required="true"/>
                                                <label for="telefono" class="label-custom" >Teléfono</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="direccion" value="#{usuariosController.user.direccion}" styleClass="form-control" required="true"/>
                                                <label for="direccion" class="label-custom">Dirección</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="contraseña" value="#{usuariosController.user.contraseña}" styleClass="form-control" required="true"/>
                                                <label for="contraseña" class="label-custom">Contraseña</label>
                                            </div>

                                            <div class="col-md-6 form-floating">
                                                <h:inputText id="edad" value="#{usuariosController.user.edad}" styleClass="form-control" required="true"/>
                                                <label for="edad" class="label-custom">Edad</label>
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label">Estado</label>
                                                <h:selectOneMenu id="estado" value="#{usuariosController.est.estadoRol}" styleClass="form-select">
                                                    <f:selectItems value="#{usuariosController.listarEstados()}" />
                                                </h:selectOneMenu>
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label">País</label>
                                                <h:selectOneMenu id="pais" value="#{usuariosController.pais.idpais}" styleClass="form-select">
                                                    <f:selectItems value="#{usuariosController.listarPaises()}" />
                                                </h:selectOneMenu>
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label">Rol</label>
                                                <h:selectOneMenu id="rol" value="#{usuariosController.user.rolId.idrol}" styleClass="form-select">
                                                    <f:selectItems value="#{usuariosController.listarRolAdmin()}" />
                                                </h:selectOneMenu>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-end mt-4">
                                        <h:commandButton value="Guardar"
                                                         action="#{usuariosController.crearUsuario()}"
                                                         rendered="#{usuariosController.user.identificacion == null}"
                                                         styleClass="btn btn-success me-2" id="abrirModal" />
                                        <h:commandButton value="Guardar Cambios"
                                                         action="#{usuariosController.editarStepTwo()}"
                                                         rendered="#{usuariosController.user.identificacion != null}"
                                                         styleClass="btn btn-warning me-2" />
                                        <button type="button" class="btn btn-cancelar" data-bs-dismiss="modal">Cancelar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </h:form>

                <script>
                    $(document).ready(function () {
                        $('.jsf-data-table').DataTable({
                            dom: 'Bfrtip',
                            language: {
                                url: "https://cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json"
                            },
                            pageLength: 50,
                            buttons: [
                                {
                                    extend: 'copy',
                                    text: 'Copiar',
                                    className: 'btn btn-copy'
                                },
                                {
                                    extend: 'csv',
                                    text: 'CSV',
                                    className: 'btn btn-info'
                                },
                                {
                                    extend: 'excel',
                                    text: 'Excel',
                                    className: 'btn btn-success'
                                },
                                {
                                    extend: 'pdf',
                                    text: 'PDF',
                                    className: 'btn btn-danger'
                                },
                                {
                                    extend: 'print',
                                    text: 'Imprimir',
                                    className: 'btn btn-imp'
                                }
                            ]
                        });
                    });

                </script>
                <script>
                    function abrirModalUsuario(data) {
                        if (data.status === "success") {
                            const modal = new bootstrap.Modal(document.getElementById("modalUsuario"));
                            modal.show();
                        }
                    }
                </script>


                <!--  PanelGroup para éxito -->
                <h:panelGroup rendered="#{not empty facesContext.messageList}">
                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            Swal.fire({
                                icon: "#{facesContext.maximumSeverity.ordinal eq 0 ? 'success' : 'error'}",
                                title: "#{facesContext.maximumSeverity.ordinal eq 0 ? 'Éxito' : 'Error'}",
                                text: "#{facesContext.messageList[0].summary}",
                                confirmButtonColor: '#efb810'
                            });
                        });
                    </script>
                </h:panelGroup>

                
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
                        integrity="sha384-kenU1KFdBIe4zVF0s0G1RWuH61DGLwZJEdK2Kadq2F9CUG65"
                crossorigin="anonymous"></script>


            </ui:define>

        </ui:composition>

    </body>
</html>
